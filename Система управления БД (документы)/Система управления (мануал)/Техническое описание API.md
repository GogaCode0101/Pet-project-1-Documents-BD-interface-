# Техническое описание API

## Обзор API

Система предоставляет REST API для взаимодействия с базой данных документооборота. Все запросы возвращают данные в формате JSON.

## Базовый URL
```
http://localhost:5000/api/
```

## Методы API

### 1. Получение данных таблицы
**GET** `/api/table/<table_name>`

Возвращает все записи из указанной таблицы с применением JOIN для справочных данных.

**Параметры:**
- `table_name` (string) - название таблицы

**Специальная обработка:**
- `города` - включает название региона
- `улицы` - включает название города  
- `предметы` - включает название улицы

**Пример запроса:**
```
GET /api/table/города
```

**Пример ответа:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "регион": "Московская область",
      "название": "Москва"
    }
  ]
}
```

### 2. Получение структуры таблицы
**GET** `/api/table_structure/<table_name>`

Возвращает структуру полей указанной таблицы.

**Параметры:**
- `table_name` (string) - название таблицы

**Пример ответа:**
```json
{
  "success": true,
  "structure": [
    {
      "name": "id",
      "type": "INTEGER"
    },
    {
      "name": "название",
      "type": "VARCHAR(255)"
    }
  ]
}
```

### 3. Добавление записи
**POST** `/api/add_record/<table_name>`

Добавляет новую запись в указанную таблицу.

**Параметры:**
- `table_name` (string) - название таблицы

**Тело запроса (JSON):**
```json
{
  "название": "Новый город",
  "регион_id": 1
}
```

**Специальная обработка:**
- `города` - требует `регион_id` и `название`
- `улицы` - требует `город_id` и `название`

**Пример ответа:**
```json
{
  "success": true,
  "data": {
    "id": 5,
    "название": "Новый город",
    "регион_id": 1
  }
}
```

### 4. Обновление записи
**POST** `/api/update_record/<table_name>`

Обновляет существующую запись в таблице.

**Параметры:**
- `table_name` (string) - название таблицы

**Тело запроса (JSON):**
```json
{
  "id": 1,
  "название": "Обновленное название",
  "регион_id": 2
}
```

**Пример ответа:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "название": "Обновленное название",
    "регион_id": 2
  }
}
```

### 5. Выполнение произвольного запроса
**POST** `/api/execute_query`

Выполняет произвольный SQL-запрос.

**Тело запроса (JSON):**
```json
{
  "query": "SELECT * FROM регионы WHERE id = 1"
}
```

**Пример ответа:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "название": "Московская область"
    }
  ]
}
```

## Обработка ошибок

При возникновении ошибки API возвращает ответ в формате:

```json
{
  "success": false,
  "error": "Описание ошибки"
}
```

**Типичные ошибки:**
- Таблица не найдена
- Нарушение ограничений целостности
- Синтаксическая ошибка в SQL-запросе
- Отсутствующие обязательные поля

## Безопасность

**Реализованные меры:**
- Параметризованные запросы для предотвращения SQL-инъекций
- Валидация типов данных
- Откат транзакций при ошибках

**Рекомендации:**
- Добавить аутентификацию (токены API)
- Ограничить права доступа к определенным операциям
- Логирование всех операций
- Rate limiting для предотвращения злоупотреблений

## Примеры использования

### JavaScript (Fetch API)
```javascript
// Получение данных
fetch('/api/table/города')
  .then(response => response.json())
  .then(data => console.log(data));

// Добавление записи
fetch('/api/add_record/города', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    название: "Санкт-Петербург",
    регион_id: 2
  })
})
.then(response => response.json())
.then(data => console.log(data));
```

### Python (requests)
```python
import requests

# Получение данных
response = requests.get('http://localhost:5000/api/table/города')
data = response.json()

# Добавление записи
new_city = {
    "название": "Екатеринбург",
    "регион_id": 3
}
response = requests.post(
    'http://localhost:5000/api/add_record/города',
    json=new_city
)
result = response.json() 