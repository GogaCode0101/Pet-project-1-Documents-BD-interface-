# Система управления базой данных - Документооборот

## Общее описание проекта

Это web-приложение для управления базой данных документооборота, разработанное на Python Flask с использованием PostgreSQL. Система предназначена для автоматизации учета и управления различными типами документов в организации: договорами, актами, справочными данными.

## Архитектура системы

### Технологический стек:
- **Backend**: Python Flask 2.3.3
- **База данных**: PostgreSQL
- **ORM**: SQLAlchemy 2.0.23
- **Frontend**: HTML, CSS, JavaScript, Bootstrap
- **Дополнительные зависимости**: psycopg2-binary, python-dotenv

### Структура проекта:
```
.
├── app.py                          # Основное приложение Flask
├── requirements.txt                # Зависимости Python
├── бд.sql                         # Схема базы данных (880 строк)
├── fill_data.sql                  # Тестовые данные (380 строк)
├── zaprosi.txt                    # Готовые SQL-запросы
├── Заnросы.txt                    # Дополнительные запросы
├── templates/                     # HTML шаблоны
│   ├── base.html                 # Базовый шаблон
│   ├── index.html                # Главная страница
│   ├── documents.html            # Страница документов
│   ├── reference.html            # Справочники
│   └── queries.html              # Выполнение запросов
└── static/
    └── style.css                 # Стили CSS
```

## Функциональность системы

### 1. Модули системы

#### 1.1 Документы (`/documents`)
Управление основными документами организации:

**Договоры:**
- Договоры оказания услуг
- Договоры подряда
- Договоры подряда с физическими лицами
- Договоры социального найма
- Дополнительные соглашения к договорам подряда

**Акты:**
- Акты выполненных работ по дополнительным соглашениям
- Акты выполненных работ с физическими лицами
- Акты дополнительных работ
- Акты оказания услуг
- Акты приема-передачи материалов
- Акты сдачи-приемки работ

**Другие документы:**
- Протоколы распределения вознаграждения

#### 1.2 Справочники (`/reference`)
Управление справочными данными:
- Регионы
- Города (с привязкой к регионам)
- Улицы (с привязкой к городам)
- Лица (контрагенты)
- Материалы
- Предметы (недвижимость)

#### 1.3 Запросы (`/queries`)
Выполнение предопределенных аналитических запросов:
- Анализ качества работ по подрядчикам
- Статистика по договорам
- Мониторинг просроченных обязательств
- Анализ клиентской базы

### 2. API функции

#### 2.1 Получение данных
- `GET /api/table/<table_name>` - получение данных таблицы с JOIN для справочников
- `GET /api/table_structure/<table_name>` - получение структуры таблицы

#### 2.2 Модификация данных
- `POST /api/add_record/<table_name>` - добавление новой записи
- `POST /api/update_record/<table_name>` - обновление существующей записи
- `POST /api/execute_query` - выполнение произвольного SQL-запроса

## База данных

### Схема базы данных

База данных содержит **27 основных таблиц** и **14 последовательностей**:

#### Справочные таблицы:
1. `регионы` - справочник регионов
2. `города` - города с привязкой к регионам
3. `улицы` - улицы с привязкой к городам
4. `лица` - физические и юридические лица
5. `материалы` - справочник материалов
6. `предметы` - объекты недвижимости

#### Основные документы:
7. `договоры_оказания_услуг`
8. `договоры_подряда`
9. `договоры_подряда_физлиц`
10. `договоры_социального_найма`
11. `дополнительные_соглашения_подряд`

#### Акты:
12. `акты_выполненных_работ_допсоглаше`
13. `акты_выполненных_работ_физлиц`
14. `акты_дополнительных_работ`
15. `акты_оказания_услуг`
16. `акты_приема_передачи_материалов`
17. `акты_сдачи_приемки_работ`

#### Вспомогательные таблицы:
18. `протоколы_распределения_вознагра`
19. `стороны_*` - связующие таблицы для участников документов
20. `позиции_*` - детализация актов и соглашений
21. `роли_участников_социального_найма`

### Ключевые особенности схемы:
- Использование кириллических названий таблиц и полей
- Нормализованная структура с внешними ключами
- Поддержка различных типов договоров и актов
- Гибкая система участников документов через связующие таблицы

## Веб-интерфейс

### Дизайн и UX:
- Современный responsive дизайн с Bootstrap
- Интуитивная навигация через карточки на главной странице
- Табличное представление данных с возможностью редактирования
- AJAX-взаимодействие для динамического обновления

### Основные страницы:

#### Главная страница (`/`)
- Навигационные карточки для каждого модуля
- Описание функциональности каждого раздела

#### Страница документов (`/documents`)
- Группировка документов по категориям
- Табличное отображение с пагинацией
- Возможность добавления и редактирования

#### Справочники (`/reference`)
- Управление справочными данными
- Поддержка связанных справочников (регион-город-улица)
- Валидация при добавлении записей

#### Запросы (`/queries`)
- Предопределенные аналитические запросы
- Возможность выполнения произвольных SQL-запросов
- Экспорт результатов

## Аналитические возможности

### Готовые отчеты:
1. **Анализ качества работ** - группировка по подрядчикам и качеству
2. **Статистика договоров** - общие показатели портфеля
3. **Мониторинг гарантий** - контроль просроченных гарантийных обязательств
4. **Анализ изменений** - договоры с наибольшим количеством дополнительных соглашений
5. **Клиентская аналитика** - активность заказчиков и динамика работы

### Примеры запросов:
```sql
-- Топ подрядчиков по качеству работ
SELECT л.фио as подрядчик,
       COUNT(ас.id) as количество_актов,
       COUNT(CASE WHEN ас.качество_работ = 'Отличное' THEN 1 END) as отличное_качество
FROM акты_сдачи_приемки_работ ас
JOIN договоры_подряда дп ON ас.договор_id = дп.id
JOIN стороны_договора_подряда сдп ON дп.id = сдп.договор_id
JOIN лица л ON сдп.лицо_id = л.id
WHERE сдп.роль = 'Подрядчик'
GROUP BY л.фио;
```

## Безопасность и надежность

### Реализованные меры:
- Параметризованные SQL-запросы для предотвращения SQL-инъекций
- Валидация входных данных на стороне сервера
- Транзакционная целостность операций с откатом при ошибках
- Обработка исключений с информативными сообщениями

### Рекомендации для production:
- Настройка SSL/TLS шифрования
- Аутентификация и авторизация пользователей
- Логирование операций
- Резервное копирование базы данных
- Мониторинг производительности

## Развертывание и настройка

### Системные требования:
- Python 3.8+
- PostgreSQL 12+
- 512MB RAM (минимум)
- 1GB свободного места на диске

### Установка:
1. Клонирование проекта
2. Установка зависимостей: `pip install -r requirements.txt`
3. Настройка подключения к PostgreSQL в `app.py`
4. Создание базы данных: выполнение `бд.sql`
5. Заполнение тестовыми данными: `fill_data.sql`
6. Запуск приложения: `python app.py`

### Конфигурация:
```python
# Настройки подключения к БД в app.py
app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://postgres:password@localhost/database_name'
```

## Возможности расширения

### Планируемые улучшения:
1. **Система пользователей** - регистрация, роли, права доступа
2. **Документооборот** - электронные подписи, статусы документов
3. **Отчетность** - генерация PDF отчетов, графики и диаграммы
4. **API** - REST API для интеграции с внешними системами
5. **Уведомления** - напоминания о сроках, email-рассылки
6. **Файловое хранилище** - загрузка и хранение документов
7. **Аудит** - журнал изменений, версионность документов

### Интеграции:
- 1С:Предприятие (импорт/экспорт данных)
- Электронный документооборот (СЭДО)
- Системы электронных торгов
- Банковские системы (контроль платежей)

## Заключение

Система представляет собой полнофункциональное web-приложение для управления документооборотом организации. Проект демонстрирует:
- Работу с реляционными базами данных
- Создание веб-интерфейсов на Flask
- Проектирование нормализованной схемы БД
- Аналитические возможности SQL
- Современные подходы к веб-разработке

Система готова к использованию в качестве основы для более сложных корпоративных решений и может служить отличным примером архитектуры информационных систем документооборота. 
